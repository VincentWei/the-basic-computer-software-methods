## 操作系统的本质和技术生态

- 混乱的认知
- 操作系统的本质和新定义
- 操作系统的技术生态

		
## 1. 混乱的认知

1. 错误使用
   * 将内核等同于操作系统
   * “微信上可以跑小程序，所以微信也是操作系统”
1. 操作系统概念的泛化
   * 城市大脑操作系统
1. 滥用生态
   * “开发个操作系统容易，难在生态建设”。但到底什么是操作系统的生态？

		
## 2. 操作系统定义的反思

> 操作系统是管理计算机硬件与软件资源的计算机程序。

上面这个定义过于简单，忽略了如下要点：

1. 操作系统对计算机的硬件资源提供了或低级或高级的抽象管理能力，方便开发者开发应用软件。
1. 操作系统为用户提供了和计算机进行交互的操作界面以及工具。

		
## 3. 操作系统的本质

1. 一个东西的本质，指将这个东西区别于其他东西的特征。
1. 操作系统的本质，就是指一个操作系统区别于另一个操作系统的技术特征。

	
### 3.1 观点

操作系统对硬件的抽象方法构成了操作系统的本质特征

- 编程语言
- 应用框架
- 应用开发接口

	
### 3.2 实例

- Unix/Linux：基于 C 语言的 POSIX 接口。
- DOS：基于 Int21 系统服务中断的汇编接口； 基于 C 语言的系统功能接口封装。
- Windows：基于 C 语言和窗体的 Win32 接口；基于 C++ 语言和文档视图的 MFC；C# 的 .Net 框架。
- macOS：基于 Objective C 和进程和窗体的接口（正在向 Swift 编程语言演进）。
- Android：基于 Java 语言和 Activity 的接口（正在向 Dart 编程语言演进）。
- iOS/tvOS/padOS/watchOS：基于 Objective C/Swift 语言和 UIKit 框架的接口。

	
- ChromeOS：Web 前端框架及接口。
- Fuchsia OS：谷歌正在开发中的下一代操作系统。

	
### 3.3 结论

1. 操作系统对应用程序的接口，是操作系统的本质，是一个操作系统区别于另一操作系统的技术特征，是操作系统的基因或者灵魂。
1. 操作系统的演进过程，就是操作系统对计算机硬件的抽象层次逐步提升的一个过程。
   - 更友好的编程语言。
   - 更好的开发工具。
1. 操作系统完成了更多的细节工作，开发者更加轻松。以多媒体播放和来电播放的协调为例，
   - POSIX：应用程序要自己处理。
   - 智能手机：应用程序不需要自己操心。

		
## 4. 操作系统的更严谨定义

操作系统是一种特殊的计算机程序，介于硬件和应用程序之间；它通过抽象的软件资源（如进程、窗体、服务等）来管理计算机的硬件资源，以方便应用开发者利用其提供的应用编程接口（API）及其工具来开发、调试和部署应用程序。

	
### 4.1 要点

1. 操作系统必须直接管理硬件
1. 操作系统为开发者服务

	
### 4.2 拨乱反正

1. 我们不能把内核称为操作系统，内核加上基础库、运行时环境以及开发、调试甚至应用的部署工具，才能称为一个操作系统。
1. 虽然微信提供了基于小程序的应用运行环境，但微信不是操作系统，因为微信管理不了计算机硬件。

	
### 4.3 兼容 POSIX 有错吗？

没错，新操作系统不兼容 POSIX 必死。因为 POSIX 已经成为操作系统和应用程序的基准和常识，而且 POSIX 不由单个厂商把控。但作为操作系统的厂商，你要考虑的是，除了兼容 POSIX，你的安身立命之本是什么？更好的实时性扩展、性能扩展、编程语言、应用框架还是开发工具？

	
### 4.4 兼容 Android 有错吗？

手机厂商角度看，没错；操作系统厂商角度看，大错特错：

1. 哲学角度看，兼容别人，你就丢失了自己的灵魂（忒修斯之船）。
1. Android 的接口及其演进由谷歌把控，你永远跟不上谷歌的步伐。
1. 为何 macOS 从来不提兼容 Windows？没有自己的灵魂，还做什么操作系统？
1. 没有设计能力、也没有自信的操作系统，才会首先想到兼容其他操作系统。

	
### 4.5 如何看 Windows 引入 WSL 和 Android 运行时？

1. Windows 拥有强大的基因，放一个兼容 Linux 的子系统，不会撼动自身的根基，反而会增强自己的技术生态。
   - WSL 让更多的 Linux 开发者留在 Windows 桌面上。
1. 作为通用操作系统，整合各种垂直技术生态是非常常见的，比如 Python、Java、Node.JS 等。
   - Android 其实并不是一个类似 Python 这样的垂直技术生态，所以 Windows 上引入 Android 的效果还有待观察。

		
## 5. 操作系统的技术生态

1. 操作系统的生态可以划分为技术生态和商业生态两个方面。
1. 技术生态指的是围绕操作系统接口形成的上下层软件之间的配合关系，向下延伸到芯片和硬件外设，向上延伸到应用和云端。
1. 商业生态指的是产业链上的厂商之间的配合关系。
1. 商业生态依附于技术生态。没有好的技术生态，商业生态是很难建立的。

	
### 为什么要单独提操作系统的技术生态？

- 很多人抱怨操作系统的生态难搞。
- 根本原因是，很多所谓国产自主操作系统，压根就不重视技术生态，只想搞商业生态。

		
## 6. 操作系统技术生态的内涵

1. 操作系统介于硬件和上层应用之间，故而，我们谈到操作系统接口的时候，除了面向应用的 API（应用编程接口）之外，还要看到另一个接口，就是向下面向芯片和硬件的接口。
1. 好的应用开发接口可有效帮助开发者开发应用，而好的芯片架构支持和驱动程序开发接口，可以帮助芯片厂商和硬件厂商快速适配新的芯片和硬件。
1. 特定操作系统的技术生态，由围绕这个操作系统的开发者构成。

	
### 6.1 GNU/Linux 的成功

1. Linux 在服务器、嵌入式等领域的成功不是偶然的：
   - FSF 的 GNU 项目奠定了大量基础，GNU 的 Hurd 内核半死不活，而 Linux 内核的出现恰逢其时；
   - Linux 内核使用 GPLv2 许可证平衡了索取和贡献，保证了商用免费；
   - Linux 内核借它的内部接口形成了自己的技术生态系统。

	
1. 作为内核，Linux 向上层提供了符合 POSIX 标准的接口，而向下为硬件外设提供了稳定和统一的驱动程序接口。正是因为 Linux 为硬件提供了统一和稳定的驱动程序接口，使得 Linux 成为硬件生产商开发计算机硬件外设时的首选，这让 Linux 内核中存在着大量的各类驱动程序，进而聚拢了大量的内核开发者，而这反过来又促进了 Linux 内核的广泛应用。

	
### 6.2 Linux 在桌面系统上的惨败

二十年来，Linux 桌面的问题一直就是这么几个：

1. 没有好的应用，没有好的游戏。
1. 兼容 Windows 的 WINE，技术问题很多。
1. 普通用户使用困难。

	
### 6.3 根本原因

1. 作为桌面，Linux 的窗口系统、GUI Toolkit 没有任何技术特色，相反理念陈旧，开发效率低下。
1. 截止目前，没看到任何一个 Linux 桌面系统以建立具有独特技术优势的技术生态为目的来打磨产品。

		
## 7. 总结

1. 操作系统的创新，向下围绕芯片和硬件支持进行，向上围绕应用开发进行。
1. 把 Linux 内核重写一遍不带来任何的技术创新。
1. 不为应用开发者考虑，不给开发者带来切实的好处的操作系统是不会有生命力的。
1. 为操作系统设计抽象层次更高的编程语言和接口，从而注入独特的基因，才能构建一个好的操作系统技术生态。
1. 要建设操作系统的商业生态，没有好的技术生态做保证，最终会失败。

