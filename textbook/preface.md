@SUBJECT [计算机软件技术导论](toc.md)  
@AUTHOR [魏永明](https://github.com/VincentWei)  
@DATE 2015-xx-xx  
@LANG 简体中文  
@COPYING 版权所有 &copy; 2022 魏永明  
@LICENSE 保留所有权利  

# 前言

## 计算机是何物？

我们通常意义上所讲的“计算机”，其全名应为“[数字计算机][1]”，或者“电子计算机”。“电子计算机”这个名称强调当前计算机的构造方法，即通过电子的晶体管来构建计算机。这不同于通过机械的方法，或者前沿的量子的方法来构建计算机。和电子计算机这个名称相比，“数字计算机”则可以更加一般性地定义计算机，这个名称强调如下事实：

计算机本质上处理的是数，而且是离散的数字。通过有限的离散的数，我们可以运用代数运算来近似地描述连续的数学公式，从而帮助人们进行运算。通过适当的编码，我们可以使用这些离散的数来表示其他现实世界中的东西，比如文字、声音、图像等等。而这些统统可被称为“[信息][2]”。

从理论讲，不论我们如何构造计算机，最终我们只能从离散的数字角度来模拟真实的世界。比如，我们无法用包括计算机在内的任何仪器来完整描述一个无理数，尽管理论上讲无理数的数量远远大于有理数，更不用说整数或者自然数了。因此，不管是电子的、机械的（如算盘或者[巴贝奇][3]在十九世纪计划用蒸汽机及齿轮构建的分析机）还是量子的计算机，最终我们只能有限地描述世界。但这已经足够，因为从哲学上讲，真实的世界其实也不是模拟的，因为数学上的不确定性以及量子角度的不确定性都说明了这个现实：我们其实生活在离散的宇宙中，而不是连续的、模拟的宇宙中，即使是时间，[本质上也是离散的][4]。

因此，把握上述这个本质，我们就可以正确认识计算机——计算机的本质特征可以概括为如下两点：

- 第一， 离散的数字。因为数学上的不确定性以及物理上的不确定性，期望一台机器可以表述连续的数学世界是不现实也是不可能的。因此，不论是什么样的仪器，其最终可处理的东西只能是离散的数字，计算机也不例外。计算机的计算能力以及容量都取决于计算机可以方便地表述多少个离散的数字。我们日常所说的 8 位、16 位或者 32 位、64 位计算机，是从信息最基础的度量单位“位（Bit）”的角度讲的；8位的计算机总共有 28（256）个离散的数字，而 64 位的计算机，则总共有 264（18446744073709551616）个离散的数字。后者的容量或者计算能力显然要比前者强很多倍。
- 第二， 编码。通过编码，我们可以用离散的数字表述现实世界中的各种各样的东西，包括数据、文字、声音、图像等等。比如，我正在使用笔记本电脑敲进去的这本书，所使用过的汉字（包括英文字母、数字、标点等，可统称为字符）大致不会超过 5000 个，我们为每个字符编一个号，就可以用一个数字序列来表示这本书的内容。实质上，计算机内部也是这么做的，当然情况要复杂一些。编码还有一个好处就是，我们可以针对这些数字做各种各样的数学运算或者操作，比如可以统计这个数字序列的长度，再乘以0.01，结果差不多就是我可以通过出版这本书拿到的每本书的版权收益。这个过程本质上也是编码，因为我们可以将统计字数和计算版税的动作也编个号，建立它们之间的一个映射关系。这种包括运算和逻辑在内的编码，也可以称为“算法”。

上面这两个计算机的本质特征，对所有类型的计算机都是适用的。比如对人和算盘形成的“计算机”而言，显然其只能表述有限的数字，其容量取决于算盘的长度（或有多少个珠子），其编码就是算盘的数字表达规则（上面的珠子一个表示 5，下面的珠子一个表示 1）以及操作人掌握的口诀及计算公式。就其他形式的计算机来讲，不论电子的计算机在多大程度上或以多快的速度被量子的计算机取代，上面这两个本质特征都不会发生变化。

更进一步，我们可以将物理的计算机本身称为“硬件”，而编码以及编码的方法称为“软件”。如此一来，硬件是变化的（从机械到电子再到量子或者将来的任何可能形态），但软件则是“永恒”的（上面两个本质不会因为硬件的变化而变化）。另外要强调的是，我们通常所讲的“软件”，的确更多地和上述计算机的本质特征中的第二点（编码），发生更直接的关联。

于是，我们可以得出一个结论：软件才是计算机科学的灵魂，硬件只是一种载体、一种媒介。即使我们没有硬件，也可以编码（编程），就像[艾达][5]为巴贝特的分析机编程一样（分析机从来没有建成过，但艾达这位天才女性却为之编写了程序），或者数学家为仅在思维中存在的[图灵机][6]编程一样。

本书将从信息的计算机处理（表述、存储、计算、传输、展现等）这一角度来为读者讲述计算机软件的本质及方法。这从某种程度上可称之为“计算机软件方法论”。

## 计算机软件

如上所述，计算机软件实质上就是对各种计算机的编码方法及规则的统称。

笔者最初建立的“计算机软件”概念，是将一个程序从一张五英寸的软磁盘上复制到 IBM 8088 PC 机上然后通过 DOS 操作系统执行该程序。你会听到一段简陋的音乐，或者进入一个游戏场景，然后通过上下左右键等按键来控制游戏中的人或者枪。那时，笔者将这种称之为“程序”的东西视作“计算机软件”。但随着对计算机了解的深入，笔者发现，对计算机而言，软件就是除了硬件之外的所有东西，没有软件，PC 机也好，服务器也好，甚至我们现在日常使用的智能手机都将失去作用——这些机器什么都做不了。

本质上讲，计算机软件是指可在计算机中执行的程序集合。“程序”又可以看成是之前所说的某种编码，尤其指包含有计算和处理逻辑的编码序列。说白了，就是一堆数据，但数据是有序的。
神奇之处在于，这堆数据通过在计算机中执行，就可以完成很多事情，简单的如求平方根，复杂的如输出乐曲、编辑和打印文本等，而这一切由前述的编码以及编码的规则所定义。计算机则忠实执行给定的指令或编码序列，从而完成我们期望的任务。

运行在现代意义上的计算机之软件，根据其功能的不同，可以划分一种分层的堆栈结构。最底下的软件通常称为“固件（firmware）”，用于计算机的启动及自检（检查计算机的外设是否工作正常并执行初始化），其上的那层软件称为“操作系统（operating system）”，再往上的软件称为“应用程序（application）”。读到这里，读者应该可以明白本书引言中提到的“全栈工程师”这个名称的来由及其比较具体的含义。

图 1  通用操作系统的软件栈

在智能手机、平板电脑等针对个人的计算机设备上，为方便程序开发或者做系统保护，人们又设计了一层新的栈，这一层软件运行在传统的操作系统之上，被称为“框架（framework）”，而应用程序又被简称为“应用（app）”。框架对应用程序来讲，其实是一种限制，它限制了应用程序可以做什么，不能做什么。比如在 Android或者 iOS 系统上，一个应用不能随意访问所有的系统资源，以此来保护设备的基本功能不被病毒或者恶意程序所破坏，或者保护用户的隐私不被轻易[泄露][7]。这大概是应用（app）这个词从应用程序（application）这个词被截断而创造出来的原因。

图 2  智能操作系统的软件栈

在更为简单的计算机系统中，比如智能手机出现之前的功能手机（feature phone）或者一些简单的智能化电子设备（如电子词典）中，软件的栈式结构可能没有那么清晰，毕竟这种设备可以完成的功能是有限的。但开发人员会在此类简单的计算机系统中有意或无意地使用类似的栈式分层概念，以使得自己的软件结构变得清晰和可维护。

那么，为什么计算机软件要使用这种分层设计的方法呢？这要从计算机软件的演进历史谈起。
计算机软件的演进

现代意义上的电子计算机出现在上个世纪二战期间（1940年代）。那时，人们通过在纸带上打眼的方式表示数据和指令（即编码），然后计算机读取纸带完成计算。我们可以将纸带上的编码序列看成是对应的计算机软件，或程序。那时及其后很长一段时间，人们编写的计算机程序中全是计算机可以直接识别的指令及其要运算的数据，而且是[二进制的][8]。此时的程序如果写在纸上，大概是这个样子的：

```
00000001
00000000
00000010
00000001
```

上面这段程序是我虚构的，大致是说将0作为当前操作的数字（指令00000001），将1加到当前操作数的值上并将结果保存起来（指令00000010）。

二进制表示的数据（比如75，其二进制表述为01001011）显然不易识别，且容易出现差错。聪明的人立即可以想到，既然计算机的处理能力那么快，为什么不让它做更多的工作？比如我们可使用更加易读的数字表示方式，如十六进制来表示数字（75 用十六进制表示就是 4B），然后让计算机自己将该十六进制的数字变成二进制并执行不就可以了吗？如此以来，程序将更为简洁，且易读易维护。于是，我们可以将上面的程序写成下面这个样子：

```
01 00
02 10
```

如果我们将用于表示指令的编码使用更加易读的文字短语来表示，那这个程序可以更进一步写成：

```
SET 0
ADD 1
```

上面这段程序使用了更加复杂的编码映射关系，引入了来自人类语言的单词（SET、ADD）来表示计算机要完成的工作，因此，这种程序被称为“汇编”。因为使用了来自人类语言的单词或类似的语法，又称为“计算机编程语言”。汇编语言的诞生极大提高了编写计算机程序的效率，而最大的好处就是，我们可以借此编写更加复杂的程序。

另外，善于抽象和总结的人们又进一步意识到，我们还可以用更加接近人类的方式编写计算机程序，从而更容易地完成编程任务和表达复杂算法。于是，FORTRAN 等高级的编程语言被设计出来。这种符合特定规则（词法和语法）的编程语言被称为“高级编程语言”。比如上面的程序，可以使用高级编程语言写成：

```
a = 0
a = a +1
```

通过使用高级编程语言，人们可以使用类似人类语言的方式为计算机编写程序。当然，这种方法编写的程序，是不能直接被计算机所识别并执行的，而需要经过解释或者编译。

解释的过程就是将使用编程语言编写的程序直接读取并按照相应的规则翻译成计算机课识别的指令。汇编语言最为简单，只要建立所使用单词和给定计算机指令代码之间的映射关系即可，几乎不涉及语法规则问题，而其他高级语言的解释显然更为复杂。

编译的过程则将高级编程语言编写的程序先整个进行翻译并最终生成可被计算机直接运行的编码序列，然后将该编码序列交给计算机执行。

从执行效率上讲，对同一种语言而言，显然编译然后执行要比边解释边执行要快。

编程语言的出现让计算机编程变成一件非常惬意的工作，实现同一功能但使用更加精巧、更加快速的程序也变成了可以向他人炫耀的资本。最终的结果是，人类的智慧可以更好地融入到程序当中。这一方面极大提高了生产效率，另一方面也推动了计算机科学自身的发展。

上个世纪70年代，计算机科学家们开始设计一种称为“操作系统”的计算机程序。这种计算机程序为计算机和程序员之间提供了一种交互能力，借此人们还可以充分使用计算机的计算能力。编写程序的工作绝大部分情况下需要相当长的时间，而计算机运行起来却很快。因此，计算机作为一个庞然大物，大部分时间是在等待人们输入新的程序。这明显是个非常大的浪费。因此，计算机科学家们开始琢磨，是否可以让许多人同时共用一台计算机？

于是，作为美国军方和贝尔实验室一个计划的一部分，UNIX 操作系统被设计出来，同时被设计出来的还有 C 语言。而设计 UNIX 的[两个主要工程师][9]，则在后来被授予图灵奖——这个计算机科学领域的最高成就奖。

UNIX 操作系统对管理现代电子计算机的资源（计算能力、存储等）带来了划时代的影响，不论是其后出现的 BSD、Linux 等 UNIX 变种操作系统还是微软公司的 Windows 系列操作系统，都沿用了其中的大部分概念，如进程、文件、目录树等等，甚至最近出现的 Android、iOS 等面向智能设备的操作系统也无出其左右。

操作系统，将计算机硬件的处理器、存储等组成单元抽象为对应的程序对象，如进程、文件系统、文件等，一方面将上层的计算机程序和繁杂的底层汇编级操作隔离开来，另一方面，文件、管道等的引入，使得程序间的协作变成可能。

有了操作系统，我们可以使用自己喜欢的任意编程语言编写程序，然后借助解释器或者编译器编译后执行自己的程序。我们编写程序的方法也从直接操作硬件变成了读取和写入文件这种抽象的操作，而且无需关心计算机系统资源（如处理器、内存）等的使用，操作系统会帮我们管理这些资源，在不同的正在运行的程序（进程）之间进行调配。

那么，分层设计到底给计算机程序带来了什么？为什么会出现一个称为“操作系统”的软件？在笔者看来，本质上，操作系统实现了如下两个关键功能：

- 计算机系统资源的抽象。比如将存储或者输入和输出设备抽象为文件。
- 应用程序编程接口（API，application programming interface）。通过提供现成可用的接口集合，实现了程序的复用，一方面提高了编程效率，另一方面使得程序的内部结构变得更为清晰。

但无论如何分层，或者如何设计，计算机程序所能完成的功能无外乎两个：接收输入并按照自己的规则或算法完成输出。

## 计算机程序的本质功能和执行原理

在阐述本节议题之前，我们先给软件及程序一个定义。先说比较容易定义的程序。程序是指最终可在计算机上执行的算法集合，通过编译或者解释成计算机可以识别的编码序列而执行。

软件则相对比较难以定义。从宽泛的意义上讲，任何包含有序数据的文件或者文件集合都可以称为软件，其关键点在于有序数据，也就是信息（纯粹的无序数据集合无法表达有意义的讯息）。比如一个字体文件，也可以称为是计算机软件，而只有该字体文件被一个渲染字体的程序读取并显示出文字的样子，这个软件才有了起真正的价值。

我们通常所理解的软件，可以从狭义上定义为包含程序和各种有序数据（信息）在内的集合。因为程序本身也是一个数据序列，因此，软件又可以定义为：一个有序数据（信息）集合，其中的某个或多个数据序列可以被计算机执行。

本质上，计算机程序所做的工作就是接收输入然后按照自己的算法进行处理，之后产生输入。这和数学上的公式基本上属于同一类东西。

我们以阿兰·图灵的图灵机作为示例来阐述计算机程序的工作原理。以下是百度百科针对“图灵机”这一词条给出的解释：

> 所谓的图灵机就是指一个抽象的机器，它有一条无限长的纸带，纸带分成了一个一个的小方格，每个方格有不同的颜色。有一个机器头在纸带上移来移去。机器头有一组内部状态，还有一些固定的程序。在每个时刻，机器头都要从当前纸带上读入一个方格信息，然后结合自己的内部状态查找程序表，根据程序输出信息到纸带方格上，并转换自己的内部状态，然后进行移动。

我估计大部分的读者看到这段解释，几乎得不到太多有价值的内容，因为我们仍然无法清晰理解图灵机到底是个什么东西。为此，笔者在这里给大家换个更容易理解的方式来解释图灵机。

图灵机是阿兰·图灵在 1936 年（那时图灵年仅二十四岁）时，为研究“实数的可计算性”这一命题而设计出来的。可计算的实数是指，这个实数可以通过给定的初始条件，通过一定的规则（或公式）计算出来。比如，对自然数5，我们可以给定 4 这个初始值和 1 这个加数，通过简单的加法计算出来，也可以通过勾三股四这个公式计算出来。理解了可计算数这个定义，我们凭直觉就可以回答：整数、[有理数][10]都是可计算的。然而，实数中占绝大多数的[无理数][11]却不这么简单。根据常识，有些我们常见的无理数，比如 π 可以被计算，但其他更多的无理数是不是可以通过一个给定的条件和规则计算出来则不能轻易下结论。

图灵借助于图灵机的研究结果表明，不是所有的实数都是可计算的。当然，这个结论对笔者以及本书的绝大多数读者来讲没有多大的意义，我们知道有这样一个结论就可以了。

我们回过头来看图灵设计的图灵机，看看为了解决实数的可计算性问题，图灵是如何一步步设计出图灵机的。

我猜想图灵首先会尝试用逻辑证明的是圆周率 π 是可计算的，毕竟 π 这个无理数具有较好的代表性，事实上，图灵的确给出了使用图灵机计算π的方法（就是算法，或者程序）。历史上出现过多种计算 π 的值的方法，从阿基米德的几何逼近法到分析法等等。有关圆周率的计算方法，读者可自行搜索互联网。

但不论使用哪种方法计算 π，其实本质上无外乎要这么做：

1. 给定一个初始条件（输入），使用一个公式来计算该初始条件下的值（输出）；
2. 然后以该值作为输入，或停止计算，或重复第一个步骤。

要假设使用一个机器来完成这个计算，那我们大致可以针对上述步骤提出如下需求：

1. 这个机器可以读取输入，也可以写下输出，还可以将自己的输出再次读取成为输入。
2. 这个机器使用一定的规则根据输入做一些处理，并将结果输出出来；在我们这里就是按照给定的公式进行计算。
3. 以上两点还蕴含一个要点，那就是机器识别输入所使用的符号；也就是说，需要设计一种符号体系，可以方便机器识别。

于是，图灵机就被设计为前述那个样子。其要点可以如《信息简史》作者所描述的那样总结如下：

1. 纸带。图灵将图灵机使用的纸带想象成一条无限长的一维的长纸条，上面是一个个格子，格子里边包含一个符号。图灵机可以读取、擦除或者写入特定的符号。纸带给以图灵机一个输入装置和临时或者永久的存储装载，而如何物理地存储这些符号则被忽略。以电子计算机为例，纸带相当于内存或者硬盘等存储设备。
2. 符号。符号及其特定的排列顺序定义了我们前述的“编码”。比如我们可以用十进制的阿拉伯数字来表示数字。在随后改进的图灵机上，图灵最终使用了 0 和 1 这两个最简单的符号，以二进制的方式来表示各种数字。
3. 状态。状态本质上可以理解为某种处理规则，它决定了针对当前由图灵机读取的符号，图灵机应该执行哪个或者哪几个动作，如前后移动纸带、擦除符号、写入新的符号、停机等等。给定某个特定的计算工作，图灵机的状态是有限的，如果将这些状态保存成一个表，则这个状态表对应于现代意义上的计算机的指令集。

尽管图灵机最初的设计目标仅仅是为了一个数学上的证明，然而，图灵机的出现却给其后的数学和信息论发展起到了很大的作用，现代电子计算机甚至将来的量子计算机本质上就是图灵机或者多个或简单或复杂的图灵机之有机结合，只是有如下两个主要区别：

- 不论哪种计算机，其存储空间（纸带）并不是无限的；
- 不论哪种计算机，执行程序都要消耗能量，其运算能力是有上限的。

当我们编写计算机程序时，时时刻刻都要受到上面两点的约束。

言归正传，图灵机不仅仅可以计算实数，通过编码（建立数字和其他现实物体之间的映射关系），图灵机可以做任何事情。比如，打印这本书的工作，大致可以用下面这台图灵机来完成：

图灵机不停读取以特定格式保存的编码序列，其中包含了这本书的文字以及格式（比如页眉、页脚、文字的大小、段落之间的分隔符等等），然后计算出每个字在纸面上要打印的位置，移动打印头，并根据这个字的[字型][12]数据，控制打印头打印出文字的字型来。

上面这台图灵机，其实就是现代针式或者激光打印机的工作原理。其中有两种形式的编码：

1. 用来控制文档内容和格式的编码。
2. 用来控制文字字型的编码。

甚至，我们可以将不同的图灵机组合起来使用，让某类图灵机专门做一件事情，而其他类型的图灵机做另外一件事情，前者的输出成为后者的输入。于是，我们现在看到的各种各样的电子设备就出现了。比如现代的电子计算机系统中，中央处理单元（CPU）是其中处于核心地位的图灵机，而包含在图形显示卡中的图形处理单元（GPU）则是另外一个复杂的图灵机。甚至在某种程度上，我们还可以将很多计算机外设（如硬盘、网卡、键盘等）视作简单的图灵机。当然，像鼠标这种外设恐怕很难被称为图灵机，毕竟其中不包含状态的概念，鼠标这种设备仅仅通过光电或者机械的方式将用户对鼠标的移动、按钮的点击等动作转换为计算机可以识别的某种编码，这类设备可以称为“编码器”或“解码器”。键盘之所以可以视作图灵机，是因为现在我们日常使用的键盘可以实现组合键、按键转义等相对较为复杂的逻辑功能。

更进一步，通过网线、USB 线或者无线网络，我们还可以将这些图灵机连接起来，在其中传输编码，这不仅仅可用来在人和人之间快速传输信息，同时也可以完成更为复杂和抽象的工作，比如流行的云端存储。哎呀，这不就是互联网吗？！

[1]: # "数字计算机：Digital Computer。“数字的（Digital）”一词和“模拟的（Analogous）”相对应。传统的电话将声音转换为强弱变化的电流并经线路传输，然后再在接收端通过扬声器播放出来，人们认为这种处理办法是模拟的，这通常意味着“信息没有损失”；而大家现今日常使用的手机，则是将声音信号在非常短的时间内进行采样，将这些采样出来的数字一个个发送到接收方，然后再将这些数字组装并通过扬声器播放。后面这种经过采样的处理方法就称为“数字化处理”。但实际上，相比模拟而言，数字化的处理办法可以提供更好的防噪声及抗干扰能力，也便于存储和处理。这点，在香农于 1948 年发表在《贝尔系统技术期刊》中的《通信的数学理论》中已经过数学上的证明。这篇论文也被视为信息论的开山之作。"
[2]: # "信息：Information。可以简单理解为数据；最近被科学家视为一种新的、可度量的物理量，详情可见《信息简史》一书。"
[3]: # "【维基百科】查尔斯·巴贝奇（Charles Babbage，1791~1871），英国数学家、发明家兼机械工程师。"
[4]: # "对该议题感兴趣的读者可以阅读《数学：确定性的丧失》、《时间简史》、《上帝掷骰子吗？》、《信息简史》等著作。"
[5]: # "艾达·洛夫莱斯（Ada Lovelace，维基百科译作埃达·洛夫莱斯）。艾达是著名诗人拜伦的女儿，遗憾的是拜伦和其母在艾达一个月时分居，此后再也未能见面。艾达死后和其父葬在一起。另外，Ada 编程语言就是为纪念艾达而命名的。"
[6]: # "图灵机是由阿兰·图灵（Alan Mathison Turing，又译作艾伦·图灵）于1936年在其论文《论可计算数及其在判定性问题上的应用》中提出的一种虚拟机器，被视为现代计算机的理论模型"
[7]: # "一个简单的例子。在智能手机上，普通应用无法读取屏幕上的内容，而在 PC 上，却没有任何限制。"
[8]: # "为何采用二进制表示数字，读者可参阅本书第一章。"
[9]: # "【维基百科】肯·汤普逊（Ken Thompson），生于美国新奥尔良，计算机科学学者与软件工程师。他与丹尼斯·里奇（Dennis MacAlistair Ritchie，逝于2011年）设计了B语言、C语言，创建了Unix和Plan 9操作系统，他也是编程语言Go的共同作者。与丹尼斯·里奇同为1983年图灵奖得主。"
[10]: # "有理数是可计算的，是因为有理数包括整数、有限小数和无限循环小数；而有限小数和无限循环小数都可以表示为某两个整数的商。"
[11]: # "无理数其实要比有理数多得多得多！笔者大学的一个数学老师曾使用一个形象的比喻来说明这个事情。假设所有的实数均匀分布于一张纱窗上，有理数的数量就是这个纱窗上的点，而其他位置弥漫的全部都是无理数。这个比喻给我的印象之深，使我在几十年后对这位老师讲解这个形象比喻的场景仍然历历在目。"
[12]: # "从代表某个文字的编码得到这个文字的具体表现样子（字型）的过程，称为字型渲染。我们熟知的字体文件保存了这些文字或字符的字型信息。"

