## 第 1 章  为什么选择二进制？

我们知道，当前我们使用的电子计算机系统在内部使用二进制进行运算，所以有 32 位、64 位系统之分。那么，为什么电子计算机使用二进制而不是我们熟悉的十进制来表示数字？将来的量子计算机会不会继续使用二进制？  

### 1.1  机械计算的需求  

人类的最早计算需求，应该和历法以及商业活动有关。准确的历法有利于人类按时耕作，获得好的收成，确保人类的繁衍生息；《史记·货殖列传》中所说“天下熙熙，皆为利来；天下攘攘，皆为利往”则是对商业活动的形象描述。在中国古代，大致发明于东汉时期的算盘，出现在阿拉伯数字之前，是实现半机械式计算的典型工具，一直延续使用上千年，在今天仍未绝迹[^1]。百度百科中如下解释算盘及珠算：  

> *用算盘计算称“珠算”，珠算有对应四则运算的相应法则，统称珠算法则。随着算盘的使用，人们总结出许多计算口诀，使计算的速度更快了。相对一般运算来看，熟练的珠算不逊于计算器，尤其在加减法方面。用时，可依口诀，上下拨动算珠，进行计算。珠算计算简便迅捷，在计算器及电脑普及前，为我国商店普遍使用的计算工具。*  

随着建筑业以及制造业的发展，人类需要更加复杂的算术运算，甚至有了多元多次方程的求解需求。仅仅通过人的纸笔计算则非常繁复且容易出错。所以，人们开始寻求通过机器来完成计算任务的方法。这一需求在二战时期因为火炮的轨迹计算[^2]以及破解密文、加密解密的要求而变得最为紧迫，最终随美国制造原子弹的曼哈顿计划之一部分，电子计算机诞生了。在不足一百年的发展过程中，电子计算机从几十吨的庞然大物变成了现在可以装在口袋里边的智能手机、戴在手腕上的智能手表。这一切听起来实在不可思议。  

简而言之，机械计算试图将所有的运算工作变成可重复的简单运算工作。从理论上讲，任何计算，都可以最终变成加法运算。拿简单的乘法运算来讲，我们可以通过重复的加法运算来获得结果；而更加复杂的曲线运算（比如抛物线、椭圆等），则可以通过泰勒级数展开、傅里叶级数展开等简化为重复的四则运算。因此，机械运算的一个最基本要求就是准确无误地重复。显然，人类不适合完成这种工作，因为人会疲劳，要吃饭、休息，工作中还容易开小差出错。相反，机器则是完成机械运算的最佳候选。  

### 1.2  各种可能的实现方法  

在刘慈欣著名的科幻小说《三体》中，作者描述了一种人肉计算机的构造方法。单个三体人可完成一个简单的二进制运算处理。假定三体人举起右手表示1，落下右手表示0。承担“取反”运算的三体人看到提供给他输入的三体人举起右手，他落下右手；对方落下右手，则他举起右手。如此就完成了二进制的取反运算。承担“或”运算的三体人则要看另外两个为他提供输入的三体人的举手状态，若其中有任何一个举起右手，则他也举起右手。如此，就可以将这些三体人串起来使用，只要有足够的三体人，就可以完成非常复杂的运算。三体人三五成群一行行排列，随着领袖的旗帜挥动，从一边开始计算。每挥动一下，一行三体人根据输入值完成计算，举起或落下他们的右手，再挥动一下，另外一行三体人根据新的输入完成一次新的计算，如此循环往复，成千上万三体人形成的人肉阵列可完成非常复杂的运算。  

显然，《三体》作者的这个实现方法参考的是我们现今使用的电子计算机的实现方法，刚才所说承担不同的二进制运算功能的三体人，在我们的术语中称为“非门”、“或门”、“与门”等等。根据布尔代数的运算规则（见第二章），通过组合不同的逻辑门，我们就可以形成二进制加法器，再通过逻辑控制和存储机制，就可以实现指令的重复性操作，最终可以完成复杂的运算。  

需要说明的是，上面的人肉阵列形成的计算机中，还要考虑逻辑控制和存储机制。比如计算结果需要存储起来作为下一次计算的初始值。所以，在人肉计算机中还要有很多用来传递计算结果的三体人组合单元；而逻辑控制部分，也由独立的三体人组合单元实现。这样，随着领袖的旗帜挥动，三体人形成的计算阵列就如随风摇曳的麦浪一般美丽和神奇。最后，旗帜对应的就是现代电子计算机中的时钟，时钟每滴答一下，完成一次计算。  

当然，我们地球人在追求完美机械计算的过程中，并没有使用过上面的人肉计算机，三体人之所以使用这个方法，是因为三体人在恶劣的自然环境中积累了知识，但缺乏物质基础，所以在需要大量计算的时候，采用了人肉计算机。相反，地球人所生存的太阳系则有良好的自然环境，知识的积累水平和物质基础的发展水平是相当的。所以，在工业时代，地球人尝试使用蒸汽机、齿轮以及机械传动装置来实现机械计算，而在信息时代，使用电子晶体管技术或者将来的量子技术实现机械计算。  

以齿轮和机械传动装置实现机械计算的实例，当属十九世纪由英国数学家巴贝奇发明的分析机[^3]。当然，分析机并没有最终完成，或者说，仅能完成一些演示。巴贝奇的分析机使用蒸汽机提供动力，使用齿轮传动系统完成**十进制**的运算，同时还设计有存储中间计算结果的“存储器”。因此，巴贝奇的分析机被认为是一部完备的图灵机。遗憾的是，因为制造工艺复杂、投资过大、进展缓慢等原因，分析机并没有在巴贝奇有生之年完成。在两百年之后，巴贝奇的设计蓝图才被现代机械工程师变为现实，并在硅谷的计算机历史博物馆展出。但是，分析机是此后大约一百年才出现的电子计算机的先驱。  

尽管巴贝奇的分析机在当时并没有完成，却激发了天才女性艾达·洛夫莱斯的兴趣，艾达为没有完成的分析机编写了世界上第一个计算机程序，该程序可以计算伯努利数[^4]。  

除了前述的算盘之外，在巴贝奇设计分析机之前，法国人布莱士·帕斯卡[^5]于 1642年发明了自动进位加法器，称为Pascalene。1694年，德国数学家弗里德·莱布尼茨[^6]改进了Pascaline，使之可以计算乘法。后来，法国人查尔斯·科尔还发明了可以进行四则运算的计算器。这些计算用设备和我们中国的算盘一样，不属于完备的图灵机范畴，而仅仅是一种辅助计算工具。毕竟，复杂计算中经常会遇到的循环、递归运算，无法通过这些计算设备进行机械式处理——本质上，这些计算工具缺乏图灵机定义的纸带（现代计算机意义上的存储器及读写控制器），从而无法将一个计算结果变成下一个计算的初始条件然后循环处理之。  

### 1.3  二进制的优势
  
在讨论二进制的优势之前，我们先看巴贝奇分析机使用的十进制带来的麻烦。  

分析机使用十进制进行运算。假定我们要用一个机构来完成十以内的加法，则可能的加法有 (0+0), (0+1), (0+2), …, (0+9),(1+0), (1+1), …, (1+9), …, (9+0), (9+1), …, (9+9)，总共 100 种情形[^7]。现在我们构造一个十进制的单个位加法器。我们可以用十种齿轮分别表示 0 到 9 的数字，要完成一个位上的加法，我们的加法器需要三个齿轮作为输入，其中两个是加数，另外一个是低位上加法的进位值，还要有两个齿轮作为输出，分别表示在这一位上的加法结果（和），以及进位值。比如我们要完成 (45+89)，低位上的 (5+9) 产生的和为4，进位值为1，高位上的 (4+8) 在运算时，要考虑低位加法产生的进位值，实际就是 (4+8+1)，结果是和为3，进位值为1，于是，在我们的加法器上，其最终的输出为 134。  

我们略去加法器内部的机械构造，假定表示加数和低位进位值的齿轮在一个轴上，表示结果（和以及进位值）的齿轮在另外一个轴上，驱动输入轴转一周（360度）可完成一次运算，结果就是输出轴上的齿轮。我们大致需要100 种不同构造的加法器，用来实现上面的 100 种十进制单个位的加法，每个加法器需要五个齿轮，所以总共需要五百个齿轮。如果考虑到不同情形下通过加数来选择不同的加法器的传动装置，这个分析机还需要更多的机械零件。倘若我们要一次完成最多十位十进制整数的加法计算，则可想而知，整个分析机的机构复杂性将超过想象。  

十进制带来的问题很明显。除去机械传动方式速度慢、能耗高、容易出现故障的不足之外，十进制计算机还有如下不足：  

- 用来表示或存储单个位的设施（对分析机而言就是“齿轮”）的种类太多（十种）。这点上，中国的算盘比分析机要巧妙得多，算盘使用单个珠子表示一或者五。  

- 用来实现单个位加法的加法器种类太多（一百种），根据不同加数选择对应加法器的过程（一百种里边选一种）也同样复杂。  

因此，从制造的角度上讲，十进制计算机的基础零件（加法器）的制造难度和复杂性都非常高，大致不亚于制造一台汽车。系统内部构造的复杂性也非常高，随着计算位数的增加，复杂性将呈几何级数增加。  

如果巴贝奇在设计分析机时使用二进制，则可能更易成功。遗憾的是，十九世纪三十年代，二进制运算的许多优势尚未被数学家们所熟知。  

十进制的劣势就是二进制的优势。比如，数字的二进制表达中的单个位只有两种可选值：0 和 1，而更为神奇的是，我们只需要一种加法器就可以实现二进制单个位的加法。  

表1-1[^8]给出了二进制表述情形下，不同输入（x 和y 为加数，z 为低位运算结果的进位值）情况下的输出（S 为和，C 为进位值）：  

表 1-1 二进制全加法器的真值表  

| x         | y         | z         | C         | S         |
|:----------|:----------|:----------|:----------|:----------|
| 0         | 0         | 0         | 0         | 0         |
| 0         | 0         | 1         | 0         | 1         |
| 0         | 1         | 0         | 0         | 1         |
| 0         | 1         | 1         | 1         | 0         |
| 1         | 0         | 0         | 0         | 1         |
| 1         | 0         | 1         | 1         | 0         |
| 1         | 1         | 0         | 1         | 0         |
| 1         | 1         | 1         | 1         | 1         |
 

根据布尔代数的运算规则，我们会发现：  

<img src="https://latex.codecogs.com/svg.image?\inline&space;S=x\oplus&space;y\oplus&space;z" />   

<br>

<img src="https://latex.codecogs.com/svg.image?\inline&space;C=x\cdot&space;y&plus;(x\bigoplus&space;y)\cdot&space;z" />  
  
<br>

其中，<img src="https://latex.codecogs.com/svg.image?\inline&space;\bigoplus" /> 表示“异或”运算（见第二章）；`·` 表示“与”运算；`+` 表示“或”运算。这样，二进制的加法器可以通过一系列二进制的逻辑运算来得出结果。而在物理上，类似三体人的人肉计算机那样，我们可以组合两个“异或门”、两个“与门”、一个“或门”来构造一个二进制的加法器。若要同时计算多位的二进制数，复制加法器并将它们连接起来就可以了。  

随着电子晶体管的发明和应用，人们发现电子晶体管的物理特性对二进制的各种逻辑运算来讲，简直可以形容为自然天成。也就是说，我们可以利用晶体管来构造不同的逻辑“门”，用来实现与、或、非、异或等基本的二进制逻辑运算，而这些逻辑运算则可以组合构成加法器，也可以用来控制各种运算的逻辑过程，也就是算法。  

晶体管还有一个好处就是非常小，可以被设计为集成电路，其中可包含成千上亿的晶体管，并进而形成只有几厘米见方（或更小的）“芯片”。而且根据对制造工艺的观察和推测，英特尔创始人之一戈登·摩尔还提出，单个芯片上可以集成的晶体管数量每十八个月就可以翻一番，性能也将翻番。这就是著名的“摩尔定律”。  

当然，随着晶体管尺寸变得越来越小，集成电路终将触及量子物理所描述的不确定性范畴，从而限制了其尺寸可以达到的极限，届时，“摩尔定律”也将走向终点。最终，量子计算机会替代电子计算机，那时，新的“摩尔定律”又将成为可能。  

但即使在量子计算机中，最底层的运算仍然会基于二进制。因为在量子尺度，人们便于测量或通过仪器感知的量子之物理属性，比如自旋方向，其最自然的表达就是二进制的 0 和 1。  

从电子计算机的发展来看，有人会认为因为晶体管的物理特性，才导致计算机科学家在电子计算机中选择了二进制。这似乎是历史的选择，而不是科学自身的选择。然而，在计算机中选择二进制作为最底层的表达，不仅仅是因为晶体管的发明，归根结底是因为数学上的进展，也就是布尔代数的发现。因此，计算机选择二进制不仅仅是历史的必然。  

几年前，国内有人描述过一种十进制计算机，然而仔细看其实现思路可知，作者描述的十进制计算机从本质仍然是二进制的；他所描述的十进制计算机仅仅参考算盘的实现，以五个比特为单位进行计算。这相当于实现了一种新的不依赖于布尔代数逻辑规则的加法器。除此之外，并无新意。  

### 1.4  电子计算机设计之道：冯·诺伊曼架构  

1945 年 6 月，冯·诺伊曼[^9]与戈德斯坦、勃克斯等人，联名发表了一篇长达 101 页纸的报告，即计算机史上著名的“101 页报告”。这个报告是现代计算机科学发展的里程碑式文献。其中明确规定用二进制替代十进制运算，并将计算机分成五大组件（即算术逻辑单元、控制单元、存储器、输入和输出，见图 1-1）。这一卓越的思想为电子计算机的逻辑结构设计奠定了基础，已成为计算机设计的基本原则。由于冯·诺伊曼在计算机逻辑结构设计上的伟大贡献，他被誉为“计算机之父”。在冯·诺伊曼架构的指导下，EDVAC 计算机于 1951 年宣告完成。  

图 1-1  冯·诺伊曼架构示意图  

冯·诺伊曼架构的各部分功能如下：  

- 输入设备和输出设备，用于进行人机交互或者计算机与计算机之间的通信。用户通过输入设备将所需要的程序和数据送至计算机中，计算机处理结束后通过输出设备展示给用户。输入设备包括键盘、鼠标、扫描仪、触摸屏、绘图板等人机交互设备。输入设备包括显示屏、投影仪、打印机、声卡等。网口、蓝牙等用于实现机器间通信的设备也属于输入输出设备。

- 存储器用于存储程序和数据。在处理过程中，某些结果是中间性质的，只需临时存储，而某些结果是持久性质的，必须长期存储。因此，计算机的存储设备可被简单划分为易失性存储器和持久性存储器。前者通常具有访问速度快，但容量小的特点，如内存（RAM）[^10]；后者通常具有访问速度慢，但容量大的特点，如硬盘。

- 控制器用来控制程序的执行，比如在内存中访问（读取或写入）数据，然后对这些数据四则运算或其他逻辑运算。

- 算术逻辑单元用于完成算术运算和逻辑运算。在现代计算机中，算术逻辑单元和控制器通常被整合在一起，形成所谓的中央处理单元（CPU）。  


冯·诺伊曼架构的最关键特征是 RAM 和 CPU 的分离设计。使用冯·诺伊曼架构的设计的 CPU，按照计算机指令能够同时处理的二进制位数确定数据的最小单位，如 32 位、64 位。这些数据在RAM 中线性存储，且每个数据有一个对应的访问地址，而 CPU 通过总线访问存储在 RAM 中的数据。  


[^1]: 【维基百科】以往认为算盘为中国发明的观点并不可靠。事实上，在古中国开始广泛流行算盘已晚至宋元时期，此前通行的是筹算。反而在巴比伦、罗马都出土过接近今日中国算盘形制的算板实物，其算盘的形制相对上有着较清晰的演进轨迹。此外，包括北非的古埃及、中亚的俄罗斯（Russian Shoty）、中古欧洲都有形制与之类似的手算盘。因此不能说算盘为中国所独有之巧思。客观来看，算盘是各地人类因应计算需要，透过文明交流而相互参考、逐渐完善的过程。  

[^2]: 火炮炮弹的轨迹计算需要建立相当复杂的数学模型。试想火炮要击落一家飞机，因为飞机在运动，就算火炮是固定的，但炮弹击发出去后也在运动，还要考虑到瞄准时飞机的位置以及计算过程所消耗的时间差，如果再加上风速等其他因素，整个火炮的控制系统会非常复杂。怪不得二战时期，科学家尤其是数学家成了各国竞争的一个焦点。  

[^3]: 巴贝奇最早设计的计算用机器称为“差分机”，主要用来实现导航表，后来发现差分机用途有限，改而设计更加通用的“分析机”。  

[^4]: 伯努利数是18世纪瑞士数学家雅各布·伯努利提出的，伯努利数的生成公式属于一种典型的递归计算。  

[^5]: 压强的单位“帕斯卡”即来自这位数学家兼科学家。  

[^6]: 和牛顿一起并称为微积分的奠基人。  

[^7]: 当然，根据整数的加法交换律，我们可以把 100 种情形缩减为一半，即 50 种。也许还有其他方法可以进一步缩减，但仍然很多。  

[^8]: 在布尔代数中，这种表称为真值表（Truth table）。  

[^9]: 【维基百科】约翰·冯·诺伊曼（John von Neumann，1903~1957），出生于匈牙利的美国籍犹太人数学家，现代计算机创始人之一。他在计算机科学、经济、物理学中的量子力学及几乎所有数学领域都作出过重大贡献。  

[^10]: 在本书中，我们使用“内存”这个术语时，特指易失性存储器，即随机访问存储器（RAM）。需要注意的是，在移动互联网时代，“内存”一词被一些不严谨的产品人员用作表示手机的持久存储器。  

